<div class="devise-page">
  <div class="d-flex">
    <!-- Men√∫ lateral fijo -->
    <aside class="bg-white p-4 border-end" style="width: 220px; min-height: 0vh; position: fixed; top: 64px; left: 0; z-index: 100;">
      <h2 class="mb-4 fw-bold" style="color: #5BA2B9;">Menu</h2>
      <ul class="list-unstyled">
        <li class="mb-3"><%= link_to "Home", root_path, class: "fw-bold text-decoration-none", style: "color: #4b9857;" %></li>
        <li class="mb-3"><%= link_to "Messages", "#", class: "fw-bold text-decoration-none", style: "color: #4b9857; letter-spacing: 1px;" %></li>
        <li class="mb-3"><%= link_to "Schedules", schedules_path, class: "fw-bold text-decoration-none", style: "color: #4b9857; letter-spacing: 1px;" %></li>
        <li class="mb-3"><%= link_to "Appointments", appointments_path, class: "fw-bold text-decoration-none", style: "color: #4b9857; letter-spacing: 1px;" %></li>
        <li class="mb-3"><%= link_to "Requests", requests_path, class: "fw-bold text-decoration-none", style: "color: #4b9857; letter-spacing: 1px;" %></li>
      </ul>
    </aside>

    <!-- Contenido principal desplazado a la derecha -->
    <section class="flex-grow-1 p-4" style="margin-left: 220px; padding-top: 80px;">
      <h1 class="fw-bold mb-4 text-center" style="color: #4b9857;">üë©‚Äç‚öïÔ∏è Psychologist Dashboard</h1>

        <!-- M√©tricas principales -->
        <div class="row text-center mb-5">
          <div class="col-md-4 mb-3">
            <div class="card signup-container p-3">
              <h6 class="text-muted">Total Patients</h6>
              <h3 class="fw-bold" style="color: #4b9857;"><%= @total_patients %></h3>
            </div>
          </div>
          <div class="col-md-4 mb-3">
            <div class="card signup-container p-3">
              <h6 class="text-muted">New Today</h6>
              <h3 class="fw-bold" style="color: #4b9857;"><%= @new_patients %></h3>
            </div>
          </div>
          <div class="col-md-4 mb-3">
            <div class="card signup-container p-3">
              <h6 class="text-muted">Old Patients</h6>
              <h3 class="fw-bold" style="color: #4b9857;"><%= @old_patients %></h3>
            </div>
          </div>
        </div>

        <!-- Gr√°ficas y secciones en dos columnas -->
<div class="row g-4">

  <!-- Distribuci√≥n de pacientes -->
  <div class="col-md-6">
    <div class="card signup-container p-3">
      <h6 class="fw-semibold text-muted">Patient Distribution</h6>
      <%= pie_chart [
        ["New", @new_patients],
        ["Old", @old_patients]
      ], height: "150px", library: { colors: ["#4b9857", "#6c757d"] } %>
    </div>
  </div>

  <!-- Citas de hoy -->
  <div class="col-md-6">
    <div class="card signup-container p-3">
      <h6 class="fw-semibold text-muted">Today's Appointments</h6>
      <% if @today_appointments.any? %>
        <ul class="list-unstyled small mb-0">
          <% @today_appointments.each do |appt| %>
            <li class="d-flex justify-content-between py-2 border-bottom">
              <strong><%= appt[:patient_name] %></strong>
              <span class="badge bg-light text-dark border"><%= appt[:time] %></span>
            </li>
          <% end %>
        </ul>
      <% else %>
        <p class="text-muted">No appointments for today.</p>
      <% end %>
    </div>
  </div>

  <!-- Top pacientes -->
  <div class="col-md-6">
    <div class="card signup-container p-3">
      <h6 class="fw-semibold text-muted">Top Active Patients</h6>
      <ul class="list-group list-group-flush">
        <% @top_patients.each do |patient| %>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <%= "#{patient.first_name} #{patient.last_name}" %>
            <span class="badge bg-success rounded-pill"><%= patient.appointments_count %> appointments</span>
          </li>
        <% end %>
      </ul>
    </div>
  </div>


  <!-- Citas en 7 d√≠as -->
  <div class="col-md-6">
    <div class="card signup-container p-3">
      <h6 class="fw-semibold text-muted">Appointments in Last 7 Days</h6>
      <%= line_chart @appointments_per_day, height: "150px", library: { colors: ["#4b9857"] } %>

    </div>
  </div>

  <!-- Estado de solicitudes -->
  <div class="col-md-6">
    <div class="card signup-container p-3">
      <h6 class="fw-semibold text-muted">Therapy Requests by Status</h6>
      <%= pie_chart @therapy_request_statuses, height: "150px", library: { colors: ["#ffc107", "#28a745", "#dc3545", "#6c757d"] } %>
    </div>
  </div>

  <!-- D√≠a m√°s activo -->
  <div class="col-md-6">
    <div class="card signup-container p-3">
      <h6 class="fw-semibold text-muted">Busiest Day</h6>
      <p class="fs-5 text-primary fw-bold mb-0">
        <%= @busiest_day.strftime("%A, %d %b %Y") if @busiest_day %>
      </p>
    </div>
  </div>

</div>

      </section>
    </div>
  </div>
</div>
